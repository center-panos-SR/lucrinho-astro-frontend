---
export interface Props {
  adClient?: string;
  adSlot?: string;
  adFormat?: string;
  fullWidthResponsive?: boolean;
  noPadding?: boolean;
}

const {
  adClient = 'ca-pub-XXXXXXXXXXXXXXXX', // Substituir pelo seu ID do AdSense
  adSlot = 'XXXXXXXXXX', // Substituir pelo ID do slot
  adFormat = 'auto',
  fullWidthResponsive = true,
  noPadding = false
} = Astro.props;
---

<!-- Google AdSense Section -->
<section class:list={['adsense-section', { 'no-padding': noPadding }]}>
  <div class="adsense-container">
    <!-- Label de Publicidade (Obrigatório pelas diretrizes) -->
    <div class="adsense-label">
      <span>Publicidade</span>
    </div>
    
    <!-- Container do anúncio -->
    <div class="adsense-wrapper">
      <ins
        class="adsbygoogle"
        style="display:block"
        data-ad-client={adClient}
        data-ad-slot={adSlot}
        data-ad-format={adFormat}
        data-full-width-responsive={fullWidthResponsive.toString()}
      ></ins>
    </div>
  </div>
</section>

<!-- Script do AdSense (carregado de forma otimizada) -->
<script is:inline>
  // Carregar AdSense de forma assíncrona e otimizada
  if (typeof window !== 'undefined') {
    // Adiar carregamento para não bloquear renderização
    const loadAdSense = () => {
      if (!document.querySelector('script[src*="adsbygoogle"]')) {
        const script = document.createElement('script');
        script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js';
        script.async = true;
        script.crossOrigin = 'anonymous';
        document.head.appendChild(script);
        
        script.onload = () => {
          (window.adsbygoogle = window.adsbygoogle || []).push({});
        };
      } else {
        (window.adsbygoogle = window.adsbygoogle || []).push({});
      }
    };

    // Carregar após interação do usuário ou após delay
    if (document.readyState === 'complete') {
      setTimeout(loadAdSense, 1000);
    } else {
      window.addEventListener('load', () => setTimeout(loadAdSense, 1000));
    }
    
    // Ou carregar na primeira interação
    const events = ['mousedown', 'touchstart', 'scroll'];
    const loadOnInteraction = () => {
      loadAdSense();
      events.forEach(event => window.removeEventListener(event, loadOnInteraction));
    };
    events.forEach(event => window.addEventListener(event, loadOnInteraction, { once: true, passive: true }));
  }
</script>

<style>
  .adsense-section {
    width: 100%;
    background-color: #F0F0F0;
    padding: 16px 0;
    margin: 0;
  }

  .adsense-section.no-padding {
    padding: 0;
  }

  .adsense-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0 16px;
  }

  .adsense-label {
    text-align: center;
    margin-bottom: 8px;
  }

  .adsense-label span {
    font-size: 11px;
    color: #4a4a4a;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-family: Arial, sans-serif;
  }

  .adsense-wrapper {
    width: 100%;
    min-height: 90px;
    max-height: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .adsbygoogle {
    display: block;
    width: 100%;
    height: 90px;
  }

  /* Responsivo */
  @media (max-width: 768px) {
    .adsense-wrapper {
      min-height: 50px;
      max-height: 90px;
    }

    .adsbygoogle {
      height: auto;
      min-height: 50px;
    }
  }

  /* Placeholder quando o anúncio não carregar */
  .adsbygoogle:empty::before {
    content: 'Espaço publicitário';
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 90px;
    color: #999;
    font-size: 14px;
    font-family: Arial, sans-serif;
  }
</style>

